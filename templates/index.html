<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consulta de Dados</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
    <div class="container">
        <h1>Consulta de Dados</h1>

        <!-- Formulário de Pesquisa -->
        <form method="POST" class="form-container">
            <div class="form-row">
                <div class="form-group">
                    <label for="cnpj">CNPJ</label>
                    <input type="text" id="cnpj" name="cnpj" placeholder="Digite CNPJ">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="nome">Nome</label>
                    <input type="text" id="nome" name="nome" placeholder="Digite Nome">
                </div>
                <div class="form-group">
                    <label for="cpf">CPF</label>
                    <input type="text" id="cpf" name="cpf" placeholder="Digite CPF">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="coringa">Pesquisa Coringa - Empresario individual</label>
                    <input type="text" id="coringa" name="coringa" placeholder="Digite Nome, Email ou Telefone">
                </div>
            </div>
            <div class="form-row">
                <button type="submit" class="btn-primary">Buscar</button>
            </div>
        </form>

        <h2>Resultados</h2>

        {% if estabelecimentos_cnpj %}
            <!-- Abas para cada CNPJ Raiz -->
            <div class="tab">
                {% for raiz in estabelecimentos_Cnpj_Raiz|unique %}
                    <button class="tablink" onclick="openTab(event, 'tab{{ raiz }}')">
                        {{ raiz }} <!-- Exibe o próprio CNPJ Raiz na guia -->
                    </button>
                {% endfor %}
            </div>
            
            <div class="form-row"> <!-- Linha para o botão de exportação -->
                <form method="GET" action="{{ url_for('export_excel') }}"> <!-- Formulário para exportação, método GET -->
                    <button type="submit" class="btn-primary">Exportar dados para Excel</button> <!-- Botão para exportar dados -->
                </form>
            </div>
            <!-- Conteúdo das abas para cada CNPJ Raiz -->
            {% for raiz in estabelecimentos_Cnpj_Raiz|unique %}
            <div id="tab{{ raiz }}" class="tab-content">
                {% for index in range(estabelecimentos_cnpj|length) %}
                    {% if estabelecimentos_Cnpj_Raiz[index] == raiz %}
                        <div class="result-block">
                            <h3>{{ empresas_nome[index] }}</h3>
                            <p><strong>CNPJ:</strong> {{ estabelecimentos_cnpj[index] }}</p>
                            <p><strong>Nome:</strong> {{ empresas_nome[index] }}</p>
                            <p><strong>Constituição:</strong> {{ estabelecimentos_data_de_inicio_de_atividade[index] }}</p>
                            <p><strong>Filial ou Matriz:</strong> {{ estabelecimentos_identificador_matriz_filial[index] }}</p>
                            <p><strong>Endereço:</strong> {{ estabelecimentos_endereco[index] }}</p>
                            <p><strong>Status:</strong>
                               <span class="{% if estabelecimentos_situacao_cadastral[index] == 'Baixada' %}status-red{% else %}status-green{% endif %}">
                                   {{ estabelecimentos_situacao_cadastral[index] }}
                               </span>
                            </p>
                            <p><strong>Data Status:</strong> {{ estabelecimentos_data_situacao_cadastral[index] }}</p>
                            <p><strong>Motivo Status:</strong> {{ estabelecimentos_motivo_situacao_cadastral[index] }}</p>
                            <p><strong>QSA:</strong> {{ socios_socios[index] }}</p>
                            <p><strong>Representante:</strong> {{ socios_repre_legal[index] }}</p>
                            <p><strong>Nome Representante:</strong> {{ socios_nome_repre[index] }}</p>
                            <p><strong>Qualificação Representante:</strong> {{ socios_quali_repre[index] }}</p>
                            <p><strong>País:</strong> {{ socios_pais[index] }}</p>
                            <p><strong>Capital Social:</strong> {{ empresas_capital_social[index] }}</p>
                            <p><strong>Ente Federativo:</strong> {{ empresas_ente_federativo[index] }}</p>
                            <p><strong>Qualificação Responsável:</strong> {{ empresas_quali_responsavel[index] }}</p>
                            <p><strong>Natureza Jurídica:</strong> {{ empresas_natureza_juridica[index] }}</p>
                            <p><strong>Porte:</strong> {{ empresas_porte[index] }}</p>
                            <p><strong>Nome Fantasia:</strong> {{ estabelecimentos_nome_fantasia[index] }}</p>
                            <p><strong>Cidade Exterior:</strong> {{ estabelecimentos_cidade_exterior[index] }}</p>
                            <p><strong>País:</strong> {{ estabelecimentos_pais[index] }}</p>
                            <p><strong>CNAE Principal:</strong> {{ estabelecimentos_cnae_principal[index] }}</p>
                            <p><strong>CNAE Secundário:</strong> {{ estabelecimentos_cnae_secundario[index] }}</p>
                            <p><strong>Telefones:</strong> {{ estabelecimentos_telefones[index] }}</p>
                            <p><strong>Email:</strong> {{ estabelecimentos_correio_eletronico[index] }}</p>
                            <p><strong>Situação Especial:</strong> {{ estabelecimentos_situacao_especial[index] }}</p>
                            <p><strong>Data da Situação Especial:</strong> {{ estabelecimentos_data_situacao_especial[index] }}</p>
                        </div>
                    {% endif %}
                {% endfor %}
            </div>
            {% endfor %}

        {% else %}
            <p>Nenhum resultado encontrado.</p>
        {% endif %}
    </div>

    <!-- JavaScript para controle das abas -->
    <script>
        function openTab(evt, tabName) {
            // Esconder todas as abas
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tab-content");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }

            // Remover a classe "active" de todos os botões
            tablinks = document.getElementsByClassName("tablink");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }

            // Exibir a aba selecionada
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.className += " active";
        }

        // Por padrão, abrir a primeira aba
        document.getElementsByClassName("tablink")[0].click();
    </script>
</body>
</html>
